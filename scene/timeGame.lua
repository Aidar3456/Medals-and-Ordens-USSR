local B = {}

function B:upBar(score)
  self.sceneGroup = display.newGroup()
  self.score =  score or 0


  display.newRoundedRect(self.sceneGroup, display.contentCenterX, 50, display.actualContentWidth, 100, 10):setFillColor(unpack(PROPS.color.up_bar));
  local toMenu = display.newText({
    parent = self.sceneGroup,
    text = "Домой",
    x = display.contentCenterX, y = 40,
    font = PROPS.font,
    fontSize = 75,
  })
  local textScore = display.newText({
    parent = self.sceneGroup,
    text = "0",
    width = 200,
    align = "left",
    x = left+120, y = top+45,
    font =  PROPS.font,
    fontSize = 70,
  })

  local star = {}
  local del = 5
--  local vertices = { 0,-110/del, 27/del,-35/del, 105/del,-35/del, 43/del,16/del, 65/del,90/del, 0,45/del, -65/del,90/del, -43/del,15/del, -105/del,-35/del, -27/del,-35/del, }
  local vertices = {147.29945249855518, 150.13932846486568, 145.666329190135, 153.96100357174873, 144.03320588171482, 157.78267867863178, 142.40008257329464, 161.60435378551483, 140.76695926487446, 165.42602889239788, 139.13383595645428, 169.24770399928093, 137.5007126480341, 173.06936904788017, 135.86758933961391, 176.89105421304703, 134.23446603119373, 180.71271926164627, 132.60134272277355, 184.53440442681313, 130.96821941435337, 188.35606947541237, 129.3351262807846, 192.177714407444, 128.93627509474754, 192.99267679452896, 128.46564799547195, 193.7548130750656, 127.92839482426643, 194.46068331599236, 127.32964530587196, 195.1068475842476, 126.67454928159714, 195.68988606333733, 125.96823647618294, 196.20631858706474, 125.21585673093796, 196.65274545550346, 124.42253977060318, 197.02570661902428, 123.5934354364872, 197.3217822611332, 122.7336835116148, 197.537512332201, 121.84841372072697, 197.66947701573372, 120.9427759051323, 197.71423637866974, 120.03713808953762, 197.66947701573372, 119.1518783569336, 197.53747209906578, 118.29211637377739, 197.32166156172752, 117.46301203966141, 197.0254249870777, 116.66969507932663, 196.65218219161034, 115.91731533408165, 196.20533287525177, 115.21100252866745, 195.6883169710636, 114.55590650439262, 195.10451406240463, 113.95715698599815, 194.45736408233643, 113.41989375650883, 193.75024661421776, 112.94926665723324, 192.98660159111023, 112.55041547119617, 192.16984882950783, 112.16481104493141, 191.26766100525856, 111.09875366091728, 188.77338767051697, 109.48831178247929, 185.00543385744095, 107.46959410607815, 180.28224483132362, 105.17868921160698, 174.92220550775528, 102.75168567895889, 169.24374103546143, 100.32469220459461, 163.56529667973518, 98.03378731012344, 158.20525735616684, 96.0150696337223, 153.4820582717657, 94.40462775528431, 149.7141145169735, 93.33856031298637, 147.2198411822319, 92.95296594500542, 146.31765335798264, 88.82229030132294, 145.94272077083588, 84.69161465764046, 145.56778818368912, 80.56093901395798, 145.19285559654236, 76.4302633702755, 144.8179230093956, 72.29958772659302, 144.44299042224884, 68.16891208291054, 144.06805783510208, 64.03823643922806, 143.69312524795532, 59.90756079554558, 143.31819266080856, 55.7768851518631, 142.9432600736618, 51.64620950818062, 142.56832748651505, 47.51553889364004, 142.1933948993683, 43.38487330824137, 141.81848242878914, 42.486960254609585, 141.69071204960346, 41.617416590452194, 141.47827103734016, 40.78103508800268, 141.18501171469688, 39.98260349035263, 140.81478640437126, 39.22691456973553, 140.37144742906094, 38.518756069242954, 139.85885716974735, 37.86291824653745, 139.28085789084435, 37.26419387385249, 138.64130191504955, 36.72736817970872, 137.94404156506062, 36.25723393633962, 137.19292916357517, 35.85858140140772, 136.39181703329086, 35.53620083257556, 135.54453738033772, 35.29859147965908, 134.66947674751282, 35.14998285099864, 133.7864600121975, 35.088768135756254, 132.90154226124287, 35.11333800852299, 132.02077858150005, 35.222078114748, 131.1502441763878, 35.41338164359331, 130.2959941327572, 35.68563675507903, 129.46409359574318, 36.03723160922527, 128.6606077104807, 36.466559395194054, 127.89159156382084, 36.972008273005486, 127.16311030089855, 37.55196891725063, 126.48122906684875, 38.20482948794961, 125.85200294852257, 38.94192315638065, 125.20570792257786, 40.97976665943861, 123.41888397932053, 44.05821505934, 120.71963287889957, 47.91711084544659, 117.33607649803162, 52.29631159454584, 113.49629648029804, 56.93565979599953, 109.42841470241547, 61.575013026595116, 105.36053292453289, 65.95421377569437, 101.52076296508312, 69.81310956180096, 98.13719652593136, 72.89155796170235, 95.4379454255104, 74.9294064939022, 93.65112148225307, 75.6664976477623, 93.00482645630836, 74.74594842642546, 88.95066417753696, 73.82539920508862, 84.89650189876556, 72.90485501289368, 80.84233961999416, 71.98431082069874, 76.78817734122276, 71.0637615993619, 72.73401506245136, 70.14321237802505, 68.67985278367996, 69.22266818583012, 64.62569050490856, 68.30212399363518, 60.57152822613716, 67.38157477229834, 56.51736594736576, 66.4610255509615, 52.46320366859436, 65.54048135876656, 48.40904138982296, 64.61992207914591, 44.354889169335365, 64.46325927972794, 43.459078297019005, 64.39598947763443, 42.5640519708395, 64.41598031669855, 41.67562639340758, 64.52108435332775, 40.799600165337324, 64.70915917307138, 39.94178446009755, 64.9780623614788, 39.10798542201519, 65.32565653324127, 38.30401170998812, 65.74979424476624, 37.53567198291421, 66.24832805246115, 36.80877238512039, 66.81912057101727, 36.12911906093359, 67.46003441512585, 35.50252318382263, 68.16892214119434, 34.93479089811444, 68.57334561645985, 34.65843703597784, 68.9881794154644, 34.405730199068785, 69.4125384092331, 34.17674582451582, 69.8455324396491, 33.97155683487654, 70.28628140687943, 33.79023615270853, 70.73389515280724, 33.63285418599844, 71.18748351931572, 33.49948637187481, 71.64616137742996, 33.39020311832428, 72.10904359817505, 33.305077347904444, 72.57524505257607, 33.244184497743845, 73.04387055337429, 33.207594975829124, 73.51403497159481, 33.195381704717875, 73.9194743335247, 33.20448948070407, 74.32383745908737, 33.23179017752409, 74.726596288383, 33.27724356204271, 75.1272277906537, 33.34081945940852, 75.52520390599966, 33.42247512191534, 75.91999657452106, 33.5221778601408, 76.31107270717621, 33.63988995552063, 76.69791430234909, 33.77557620406151, 77.0799832418561, 33.92919888719916, 77.45676152408123, 34.100722800940275, 77.82771605998278, 34.29011022672057, 78.19232381880283, 34.49732596054673, 79.03347797691822, 34.99994846060872, 81.35902360081673, 36.389550659805536, 84.87208038568497, 38.488739635795355, 89.27577808499336, 41.1201149225235, 94.27321627736092, 44.106283597648144, 99.56755489110947, 47.26984519511461, 104.8618733882904, 50.433411821722984, 109.85933169722557, 53.41957546770573, 114.26301933825016, 56.05095326900482, 117.7760761231184, 58.15013721585274, 120.1016217470169, 59.53973941504955, 120.9427759051323, 60.04237197339535, 124.50400181114674, 57.91361667215824, 128.06522771716118, 55.784861370921135, 131.62645362317562, 53.65610606968403, 135.18767952919006, 51.52735076844692, 138.7489054352045, 49.39860049635172, 142.31013134121895, 47.26984519511461, 145.8713572472334, 45.14109492301941, 149.43258315324783, 43.0123396217823, 152.99380905926228, 40.8835843205452, 156.55503496527672, 38.75483153387904, 160.11626087129116, 36.62607874721289, 163.6774968355894, 34.49732596054673, 164.47522938251495, 34.06982123851776, 165.3006825596094, 33.7275680154562, 166.14762023091316, 33.47029723227024, 167.00981631875038, 33.29773982986808, 167.88103468716145, 33.209626749157906, 168.75504925847054, 33.20569396018982, 169.62563395500183, 33.28566988930106, 170.4865224659443, 33.449285477399826, 171.3315188884735, 33.69627417996526, 172.15438708662987, 34.02636693790555, 172.94889092445374, 34.4392946921289, 173.70877414941788, 34.93479089811444, 174.41792339086533, 35.50404952839017, 175.0590182840824, 36.13194040954113, 175.6299063563347, 36.81263979524374, 176.12847536802292, 37.54032896831632, 176.55259296298027, 38.309184182435274, 176.9001066684723, 39.11338672041893, 177.16892436146736, 39.94711535051465, 177.35689356923103, 40.80454632639885, 177.46188193559647, 41.679860930889845, 177.48179733753204, 42.56723541766405, 177.4144470691681, 43.46085358411074, 177.25777924060822, 44.354889169335365, 177.04041972756386, 45.31212095171213, 176.43951773643494, 47.95858617872, 175.53173750638962, 51.95643715560436, 174.39384385943413, 56.96783624589443, 173.10252115130424, 62.6549206674099, 171.73449397087097, 68.67985278367996, 170.3664466738701, 74.70478992909193, 169.0751239657402, 80.3918793797493, 167.9372202605009, 85.40326841175556, 167.0294601470232, 89.40112441778183, 166.42854809761047, 92.0475896447897, 166.21118858456612, 93.00482645630836, 169.3329982459545, 95.7415446639061, 172.4548079073429, 98.47826287150383, 175.5766175687313, 101.21498107910156, 178.6984272301197, 103.9516992866993, 181.8202368915081, 106.68841749429703, 184.9420465528965, 109.42513570189476, 188.0638562142849, 112.16185390949249, 191.1856658756733, 114.89857211709023, 194.3074755370617, 117.63529032468796, 197.4292851984501, 120.37200853228569, 200.55109485983849, 123.10872673988342, 203.67284417152405, 125.84546506404877, 204.32586818933487, 126.47606916725636, 204.90627139806747, 127.15887576341629, 205.41236400604248, 127.8879202902317, 205.84249645471573, 128.65722812712193, 206.19501918554306, 129.46082465350628, 206.4682424068451, 130.2927352488041, 206.66051656007767, 131.1469953507185, 206.7701518535614, 132.01764039695263, 206.79553896188736, 132.898685708642, 206.73498809337616, 133.78416672348976, 206.58680945634842, 134.66810882091522, 206.36122226715088, 135.50072349607944, 206.34935349225998, 135.54453738033772, 206.02829307317734, 136.39194779098034, 205.63046783208847, 137.19346225261688, 205.16062527894974, 137.94513791799545, 204.6236738562584, 138.64304199814796, 204.02444154024124, 139.28324170410633, 203.3677764236927, 139.86180424690247, 202.65850648283958, 140.37479683756828, 201.90149992704391, 140.8182766288519, 201.1015646159649, 141.188320890069, 200.26356875896454, 141.48099683225155, 199.3923805654049, 141.69236160814762, 198.49280789494514, 141.81848242878914, 197.51765727996826, 141.9070053845644, 194.8216751217842, 142.15175360441208, 190.74903577566147, 142.5214760005474, 185.64385324716568, 142.98493154346943, 179.85036224126816, 143.51087920367718, 173.71269688010216, 144.0680678933859, 167.57503151893616, 144.6252565830946, 161.78153045475483, 145.15120424330235, 156.67636804282665, 145.61465978622437, 152.6037085801363, 145.9843821823597, 149.90772642195225, 146.22913040220737, 148.93257580697536, 146.31765335798264}


  for i = 1, 3 do
    star[i] = display.newPolygon(self.sceneGroup, 750-(i*70), 50, vertices )
    star[i].fill = {unpack(PROPS.color.achieve)}
    star[i].strokeWidth = 0
    star[i]:setStrokeColor(unpack(PROPS.color.achieve))
    star[i]:rotate(37)
    star[i]:scale(0.4,0.4)
    --star[i].x = centerX
  --  star[i].y = centerY
  end

local df = display.newGroup()
  for i = 1, #vertices, 2 do
   display.newCircle(df, vertices[i]*10, vertices[i+1]*10, 10 )
  end
--df:scale(0.1,0.1)
df.x = centerX
df.y = centerY

  function self.timeStripe(time)
    local rt = 100
    local child_class = {}
    self.time = time or 2
    self.time = self.time * 1000
    self.line_time = display.newRoundedRect(self.sceneGroup, left, 105, fullw, 10, 12)
    self.line_time:setFillColor(unpack(PROPS.color.achieve))
    self.line_time.anchorX = 0

    function child_class.startTime()
      function manageTime( event )
        rt = rt - 100/(self.time/100)
      end
  	  self.time_game = timer.performWithDelay( 100, manageTime, 0 )

      transition.to(self.line_time,{
        time=self.time,
        alpha=1, x = -fullw+left,
        tag="tagPauseLineTime",
        onCancel = function()
          timer.cancel(self.time_game)
          self.line_time.x = left
          --self.line_time:removeSelf()
        end,
        onComplete = function()
          timer.cancel(self.time_game)
    	    self.gameOver()
        end
       })
      return child_class
     end
     child_class.startTime()
   return child_class
  end

  self.mistake = 0
  function self.update()
    if (self.mistake > 0 and self.mistake < 4) then
      star[self.mistake]:setStrokeColor(unpack(PROPS.color.grey))
      star[self.mistake].fill = {unpack(PROPS.color.grey)}
    elseif (self.mistake > 3) then
	   self.gameOver()
	   --B.gameOV(composer) --composer.showOverlay("scene.gameOver", {time = 800, effect="crossFade", isModal = true,})
    end
    textScore.text = self.score
   end



  -- function toMenu:touch(e)
    -- if (tumb == true) then
      -- if (e.phase == "began") then
        -- transition.cancel("transTag")
        -- composer.gotoScene("scene.menu", {time = 500, effect="crossFade"})
        -- composer.removeScene("scene.game", {time = 500})
    -- end
    -- return true
   -- end
  -- end
  -- toMenu:addEventListener( "touch", toMenu )
  return self
end

return B
